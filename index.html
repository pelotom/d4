<!DOCTYPE html>
<html>
<body>
<script src='bower_components/d3/d3.js' charset='utf-8'></script>
<script src='bower_components/jquery/jquery.js' charset='utf-8'></script>
<script src='bower_components/lodash/dist/lodash.js' charset='utf-8'></script>
<script src='d4.js' charset='utf-8'></script>
<script>

var boxSpec = {
  type: 'rect',
  enter: function(rect, d) {
    rect
      .attr('x', d.bounds[0])
      .attr('y', d.bounds[1])
      .attr('width', 0)
      .attr('height', d.bounds[3])
      .attr('fill', d.color)
      .attr('opacity', 0)
      ;
  },
  merge: function(rect, d, i) {
    rect
      .transition()
      .duration(1000)
      .attr('x', d.bounds[0])
      .attr('y', d.bounds[1])
      .attr('width', d.bounds[2])
      .attr('height', d.bounds[3])
      .attr('fill', d.color)
      .attr('opacity', 1)
      ;
  }
}

var rowSpec = {
  type: 'g',
  enter: function(g, row) {
    g.attr('transform', 'translate(0,' + row.offset + ')');
  },
  children: [
    // background
    {
      spec: {
        type: 'rect',
        enter: function(rect, row) {
          rect
            .attr('width', $(window).width())
            .attr('height', 2)
            .attr('fill', row.color);
        }
      }
    },
    {
      spec: mainSpec
    }
  ]
};

function mainSpec() {
  return {
    type: 'svg',
    key: function(d) { return d.id; },
    merge: function(svg, d, i) {
      svg
        .attr('width', d.width)
        .attr('height', d.height)
        .style('background-color', 'green')
        ;
    },
    children: [
      {
        data: function(d) { return d.rows || []; },
        spec: rowSpec
      },
      {
        data: function(d) { return d.boxes || []; },
        spec: boxSpec
      }
    ]
  };
};

var chart = d4.build(d3.select('body'), mainSpec);

var bunch = _.map(_.range(1000), function (n) {
  return {
    bounds: [n/3,n/2,n,0.4],
    color: 'red'
  };
})

chart.draw([{
  width: $(window).width() - 30,
  height: $(window).height() - 30,
  boxes: bunch,
  rows: [
    {
      offset: 250,
      boxes: [
        {
          bounds: [200,150,100,45],
          color: 'red'
        },
        {
          bounds: [600,100,10,19],
          color: 'blue'
        }
      ],
      color: 'gray'
    }
  ],
}]);

</script>
</body>
</html>