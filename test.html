<!DOCTYPE html>
<html>
<head>
<style>

table {
  position: absolute;
  height: 98%;
  width: 99%;
  z-index: -1;
}

table, th, td {
  border: 1px solid black;
}

td {
  text-align: center;
  vertical-align: middle;
}

table, td, th {
  border:1px solid green;
}

th {
  background-color:green;
  color:white;
}

</style>
</head>
<body>
<script src='bower_components/requirejs/require.js' charset='utf-8'></script>
<script>

require.config({
  paths: {
    d3: 'bower_components/d3/d3',
    underscore: 'bower_components/lodash/dist/lodash',
    jquery: 'bower_components/jquery/jquery'
  },
  shim: {
    d3: { exports: 'd3' },
    underscore: { exports: '_' },
    jquery: { exports: '$' }
  }
});

require(['d3', 'd4', 'underscore', 'jquery'], function(d3, d4, _, $) {

var seeds = _.range(200);
var colors = d3.scale.category20().domain(seeds);

var data = seeds.map(function(n) {
  return {
    type: n % 2 === 0 ? 'rect' : 'circle',
    center: [Math.random() * $(window).width(), Math.random() * $(window).height()],
    size: 10 + Math.random() * 30,
    color: colors(n)
  }
});

function polySpec() {
  var rectSpec = d4('rect')
    .merge(function(rect, d) {
      return rect
        .classed('polymorph', true)
        .attr('x', -d.size)
        .attr('y', -d.size)
        .attr('width', 2 * d.size)
        .attr('height', 2 * d.size)
        .attr('fill', d.color)
        .attr('opacity', 0.5)
        ;
    })
    ;

  var circSpec = d4('circle')
    .merge(function(circle, d) {
      return circle
        .classed('polymorph', true)
        .attr('r', d.size)
        .attr('fill', d.color)
        .attr('opacity', 0.5)
        ;
    })

  return d4('g')
    .enter(function(g, d) {
      g.call(d3.behavior.drag().on('drag', function() {
        d.center = [d3.event.x, d3.event.y];
      }));
      $(g.node()).click(function() {
        d.type = d.type === 'circle' ? 'rect' : 'circle';
      });
    })
    .merge(function(g, d) {
      return g.attr('transform', 'translate(' + d.center[0] + ',' + d.center[1] + ')');
    })
    .child(rectSpec, function(d) { if (d.type === 'rect') return d; })
    .child(circSpec, function(d) { if (d.type === 'circle') return d; })
    ;
}

var svg = d3.select('body').append('svg');

(function foo() {
  polySpec().render(svg, data);
  setTimeout(foo, 10);
})();

});

</script>
</body>
</html>