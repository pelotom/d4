<!DOCTYPE html>
<html>
<head>
<style>

table {
  position: absolute;
  height: 98%;
  width: 99%;
  z-index: -1;
}

table, th, td {
  border: 1px solid black;
}

td {
  text-align: center;
  vertical-align: middle;
}

table, td, th {
  border:1px solid green;
}

th {
  background-color:green;
  color:white;
}

</style>
</head>
<body>
<script src='bower_components/requirejs/require.js' charset='utf-8'></script>
<script>

require.config({
  paths: {
    d3: 'bower_components/d3/d3',
    underscore: 'bower_components/lodash/dist/lodash',
    jquery: 'bower_components/jquery/jquery'
  },
  shim: {
    d3: { exports: 'd3' },
    underscore: { exports: '_' },
    jquery: { exports: '$' }
  }
});

require(['d3', 'd4', 'underscore', 'jquery'], function(d3, d4, _, $) {

var seeds = _.range(200);
var colors = d3.scale.category20().domain(seeds);
var zoom = d3.behavior.zoom();

var data = seeds.map(function(n) {
  return {
    type: n % 3 == 0 ? 'rect' : n % 3 == 1 ? 'circle' : 'triangle',
    center: [Math.random() * $(window).width(), Math.random() * $(window).height()],
    size: 10 + Math.random() * 30,
    color: colors(n)
  }
});

function isRect(d) {
  return d.type === 'rect';
}

function isCircle(d) {
  return d.type === 'circle';
}

function isTriangle(d) {
  return d.type === 'triangle';
}

function polySpec() {
  var rectSpec = d4('rect')
    .merge(function(rect, d) {
      return rect
        .classed('polymorph', true)
        .attr('x', -d.size)
        .attr('y', -d.size)
        .attr('width', 2 * d.size)
        .attr('height', 2 * d.size)
        ;
    })
    ;

  var circSpec = d4('circle')
    .merge(function(circle, d) {
      return circle
        .classed('polymorph', true)
        .attr('r', d.size)
        ;
    })
    ;

  var triangleSpec = d4('path')
    .merge(function(path, d) {
      return path
        .attr('d', d3.svg.line()
          .x(function(pair){return pair[0];})
          .y(function(pair){return pair[1];})
          .interpolate('linear')([
            [0,-d.size],
            [d.size,d.size],
            [-d.size,d.size]
          ]) + 'Z'
        )
        ;
    })

  return d4('g')
    .enter(function(g, d) {
      g.call(d3.behavior.drag().on('drag', function() {
        d.center = [d3.event.x, d3.event.y];
      }));
      $(g.node()).click(function() {
        d.type = isCircle(d) ? 'rect' : isRect(d) ? 'triangle' : 'circle';
        d.color = 'black';
      });
    })
    .merge(function(g, d) {
      return g.attr('transform',
        'translate(' + zoom.translate()[0] + ', ' + zoom.translate()[1] + ')' +
        'scale(' + zoom.scale() + ') ' +
        'translate(' + d.center[0] + ',' + d.center[1] + ')'
      )
      .attr('fill', d.color)
      .attr('opacity', 0.5)
      ;
    })
    .child(rectSpec, function(d) { if (isRect(d)) return d; })
    .child(circSpec, function(d) { if (isCircle(d)) return d; })
    .child(triangleSpec, function(d) { if (isTriangle(d)) return d; })
    ;
}

var svg = d3.select('body').append('svg').call(zoom);

(function foo() {
  polySpec().render(svg, data);
  setTimeout(foo, 10);
})();

});

</script>
</body>
</html>